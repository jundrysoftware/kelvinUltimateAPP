{"version":3,"sources":["webpack:///src/app/pages/checkout/checkout.page.html","webpack:///src/app/pages/checkout/checkout-routing.module.ts","webpack:///src/app/pages/checkout/checkout.module.ts","webpack:///src/app/pages/checkout/checkout.page.scss","webpack:///src/app/pages/checkout/checkout.page.ts"],"names":["routes","path","component","CheckoutPageRoutingModule","imports","forChild","exports","CheckoutPageModule","declarations","CheckoutPage","http","router","storageService","_methodsApiRestService","stripe","Stripe","valorpago","cartProducts","setupStripe","localStorage","getItem","elements","style","base","color","lineHeight","fontFamily","fontSmoothing","fontSize","invalid","iconColor","card","create","console","log","mount","addEventListener","event","displayError","document","getElementById","error","textContent","message","form","preventDefault","createSource","then","result","errorElement","makePayment","token","name","email","amount","parseInt","post","source","id","subscribe","data","datos","price","status","cliente","shipping","tax","PostMethod","response","obj","JSON","parse","removeItem","x","prod","orden","product","cant","ok","fire","navigate","selector","template"],"mappings":"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","file":"pages-checkout-checkout-module-es5.js","sourcesContent":["export default \"<ion-header class=\\\"ion-no-border\\\">\\n  <ion-toolbar color=\\\"dark\\\">\\n\\n    <!-- Back to previous page -->\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button color=\\\"white\\\" default-href=\\\"\\\" (click)=\\\"dismiss()\\\" text=\\\"\\\" icon=\\\"arrow-back\\\">\\n      </ion-back-button>\\n    </ion-buttons>\\n\\n    <!-- Title -->\\n    <ion-title></ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n<ion-card class=\\\"welcome-card\\\" style=\\\"margin-top: auto;margin-bottom: auto;\\\">\\n  <ion-img src=\\\"/assets/stripe.png\\\"></ion-img>\\n  <ion-card-header>\\n    <ion-card-subtitle>Checkout</ion-card-subtitle>\\n    <ion-card-title>Pay with Stripe</ion-card-title>\\n    <ion-row>\\n      <ion-col>Total Payment</ion-col>\\n      <ion-col>$ {{valorpago}} </ion-col>\\n    </ion-row>\\n  </ion-card-header>\\n  <ion-card-content>\\n    <form action=\\\"/\\\" method=\\\"post\\\" id=\\\"payment-form\\\">\\n      <div class=\\\"form-row\\\">\\n        <div id=\\\"card-element\\\">\\n          <!-- a Stripe Element will be inserted here. -->\\n        </div>\\n        <!-- Used to display Element errors -->\\n        <div id=\\\"card-errors\\\" role=\\\"alert\\\"></div>\\n      </div>\\n      <ion-button type=\\\"submit\\\" color=\\\"success\\\" expand=\\\"full\\\">Make Payment</ion-button>\\n    </form>\\n  </ion-card-content>\\n</ion-card>\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { CheckoutPage } from './checkout.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: CheckoutPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class CheckoutPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { CheckoutPageRoutingModule } from './checkout-routing.module';\n\nimport { CheckoutPage } from './checkout.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    CheckoutPageRoutingModule\n  ],\n  declarations: [CheckoutPage]\n})\nexport class CheckoutPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL2NoZWNrb3V0L2NoZWNrb3V0LnBhZ2Uuc2NzcyJ9 */\";","import { Component, OnInit } from '@angular/core';\ndeclare var Stripe;\nimport { HttpClient } from \"@angular/common/http\";\nimport Swal from 'sweetalert2';\nimport { Router } from '@angular/router';\nimport { StorageService } from '../../services/storage.service';\nimport { MethodApiServiceService } from '../../services/method-api-service.service';\nimport { Product } from '../../models/product.model';\n\n@Component({\n  selector: 'app-checkout',\n  templateUrl: './checkout.page.html',\n  styleUrls: ['./checkout.page.scss'],\n})\nexport class CheckoutPage implements OnInit {\n\n  stripe = Stripe('pk_test_51HdzaMJIWmXMvhqj9x3dBdLLpuuiYlI4EJcFF15XEvajtun9Qm6wu1SdopTvCYcML57NB5An5D62CdlGRytg6Wph00PkDTlUOG');\n  card: any;\n  valorpago : string = '0';\n  cartProducts: Product[] = [];\n\n  constructor(private http: HttpClient,private router: Router,\n    public storageService: StorageService,\n    private _methodsApiRestService: MethodApiServiceService) {\n  }\n\n  ngOnInit() {\n    this.setupStripe();\n    this.valorpago = localStorage.getItem('pagos');\n    if(this.valorpago=='' || this.valorpago== null){\n      this.valorpago = '0'\n    }\n  }\n\n  setupStripe() {\n    let elements = this.stripe.elements();\n    var style = {\n      base: {\n        color: '#32325d',\n        lineHeight: '24px',\n        fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n        fontSmoothing: 'antialiased',\n        fontSize: '16px',\n        '::placeholder': {\n          color: '#aab7c4'\n        }\n      },\n      invalid: {\n        color: '#fa755a',\n        iconColor: '#fa755a'\n      }\n    };\n\n    this.card = elements.create('card', { style: style });\n    console.log(this.card);\n    this.card.mount('#card-element');\n\n    this.card.addEventListener('change', event => {\n      var displayError = document.getElementById('card-errors');\n      if (event.error) {\n        displayError.textContent = event.error.message;\n      } else {\n        displayError.textContent = '';\n      }\n    });\n\n    var form = document.getElementById('payment-form');\n    form.addEventListener('submit', event => {\n      event.preventDefault();\n      this.stripe.createSource(this.card).then(result => {\n        if (result.error) {\n          var errorElement = document.getElementById('card-errors');\n          errorElement.textContent = result.error.message;\n        } else {\n          this.makePayment(result);\n        }\n      });\n    });\n  }\n\n  makePayment(token) {\n    var name = localStorage.getItem('name');\n    var email = localStorage.getItem('email');\n    var amount = localStorage.getItem('pagos')+'00';\n    if(parseInt(amount)>0){\n      this.http\n      .post('http://localhost:4242/create-charge', {\n          token: token.source.id,\n          name: name,\n          email:email,\n          amount:amount\n        })\n        .subscribe(data => {\n          if(data['charge']['status'] = 'succeeded'){\n            let datos = {\n              price:localStorage.getItem('pagos'),\n              status: 'approed',\n              cliente : localStorage.getItem('iduser'),\n              shipping : '123',\n              tax : '12'\n            }\n            this._methodsApiRestService.PostMethod('create_orders_controller.php',datos)\n            .subscribe(\n              response => {\n                if(response['code']==200){\n                  let obj = JSON.parse(localStorage.getItem('_cap_my-cart'));\n                  localStorage.removeItem(\"_cap_my-cart\");\n                  localStorage.removeItem(\"pagos\");\n                  for(let x of obj){\n                    let prod={\n                      orden:response['orden'],\n                      product: x['id'],\n                      cant: x['quantity']\n                    }\n                    this._methodsApiRestService.PostMethod('create_product_order_controller.php',prod)\n                    .subscribe(\n                      response => {\n                       console.log(response);\n                      },\n                        error => {\n                          if (!error.ok) {\n                            Swal.fire(\"Ups!\", \"Error en Petición\", \"error\");\n                          }\n                        }\n                    );\n                  }\n                }\n              },\n                error => {\n                  if (!error.ok) {\n                    Swal.fire(\"Ups!\", \"Error en Petición\", \"error\");\n                  }\n                }\n            );\n            this.valorpago = '0';\n            this.router.navigate(['/tabs/tab1']);\n            Swal.fire('Transaction succesfull!', 'Your transaction has been aproved succesfully', 'success');\n          }else{\n            Swal.fire('Transaction Error!', 'Status: ' + data['charge']['status'], 'error');\n          }\n        });\n    }\n  }\n\n}\n"]}